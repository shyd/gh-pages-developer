<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Jekyll v4.1.1"><meta property=og:title content="Building an IKEA Firefly Light with ATtiny85"><meta name=author content="Dennis Schütt"><meta property=og:locale content=en_US><meta name=description content="Did you ever wanted your room decoration to be a smoothly fading light strip in a jar? Inspired by the Pimoroni firefly light I built my own variation with an ATtiny and two AA batteries instead of using a Raspberry Pi Zero and a huge battery pack."><meta property=og:description content="Did you ever wanted your room decoration to be a smoothly fading light strip in a jar? Inspired by the Pimoroni firefly light I built my own variation with an ATtiny and two AA batteries instead of using a Raspberry Pi Zero and a huge battery pack."><link rel=canonical href=https://schuett.io/2017/05/building-ikea-firefly-light-attiny/ ><meta property=og:url content=https://schuett.io/2017/05/building-ikea-firefly-light-attiny/ ><meta property=og:site_name content=schuett.io><meta property=og:image content=https://schuett.io/7efa1ce971a0a50f0e2369973e91806cc1b6a06c.png><meta property=og:type content=article><meta property=article:published_time content=2017-05-08T15:39:25+02:00><meta name=twitter:card content=summary_large_image><meta property=twitter:image content=https://schuett.io/7efa1ce971a0a50f0e2369973e91806cc1b6a06c.png><meta property=twitter:title content="Building an IKEA Firefly Light with ATtiny85"><script type=application/ld+json>{"datePublished":"2017-05-08T15:39:25+02:00","image":"https://schuett.io/7efa1ce971a0a50f0e2369973e91806cc1b6a06c.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://schuett.io/2017/05/building-ikea-firefly-light-attiny/"},"url":"https://schuett.io/2017/05/building-ikea-firefly-light-attiny/","author":{"@type":"Person","name":"Dennis Schütt"},"description":"Did you ever wanted your room decoration to be a smoothly fading light strip in a jar? Inspired by the Pimoroni firefly light I built my own variation with an ATtiny and two AA batteries instead of using a Raspberry Pi Zero and a huge battery pack.","headline":"Building an IKEA Firefly Light with ATtiny85","dateModified":"2017-05-08T15:39:25+02:00","@type":"BlogPosting","@context":"https://schema.org"}</script><title>Building an IKEA Firefly Light with ATtiny85 &middot; schuett.io</title><meta name=author content="Dennis Schütt"><link rel=alternate type=application/rss+xml title="schuett.io &middot; another tech blog.
" href=/feed.xml><link rel=stylesheet href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=/assets/stylesheets/styles-9045b1fd1b.min.css><link rel="shortcut icon" type=image/x-icon href=/assets/images/favicon.ico><link rel=icon type=image/x-icon href=/assets/images/favicon.ico><link rel=icon type=image/gif href=/assets/images/favicon.gif><link rel=icon type=image/png href=/assets/images/favicon.png><link rel=apple-touch-icon href=/assets/images/apple-touch-icon.png><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-57x57.png sizes=57x57><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-60x60.png sizes=60x60><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-72x72.png sizes=72x72><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-76x76.png sizes=76x76><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-114x114.png sizes=114x114><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-120x120.png sizes=120x120><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-128x128.png sizes=128x128><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-144x144.png sizes=144x144><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-152x152.png sizes=152x152><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-180x180.png sizes=180x180><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-precomposed.png><link rel=icon type=image/png href=/assets/images/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/assets/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/images/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/assets/images/favicon-160x160.png sizes=160x160><link rel=icon type=image/png href=/assets/images/favicon-192x192.png sizes=192x192><link rel=icon type=image/png href=/assets/images/favicon-196x196.png sizes=196x196><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-navbutton-color content=#ffffff><meta name=application-name content=schuett.io><meta name=msapplication-tooltip content=schuett.io><meta name=apple-mobile-web-app-title content=schuett.io></head><body><!--[if lt IE 10]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]--><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href=https://schuett.io><span class="fa-layers fa-fw"><i class="far fa-window-maximize" style="" data-fa-transform=""></i> <i class="fas fa-chevron-left" data-fa-transform="shrink-13 down-2 left-4.7"></i> <i class="fas fa-chevron-right" data-fa-transform="shrink-13 down-2 right-4.7"></i> <i class="fas fa-cogs" data-fa-transform="shrink-11 down-2"></i> </span><span>schuett.io</span></a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a href=/ >Blog</a></li><li><a href=/tags>Tags</a></li><li><a href=/wtf>About</a></li><li><a href=/contact>Contact</a></li><li><a href=/imprint>Imprint</a></li></ul></div></div></nav><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=page-image><picture><source srcset="/assets/images/7efa1ce971a0a50f0e2369973e91806cc1b6a06c-1000-73f4bd007.webp 1000w, /assets/images/7efa1ce971a0a50f0e2369973e91806cc1b6a06c-1200-73f4bd007.webp 1200w" type=image/webp><source srcset="/assets/images/7efa1ce971a0a50f0e2369973e91806cc1b6a06c-1000-73f4bd007.png 1000w, /assets/images/7efa1ce971a0a50f0e2369973e91806cc1b6a06c-1200-73f4bd007.png 1200w" type=image/png><img src=/assets/images/7efa1ce971a0a50f0e2369973e91806cc1b6a06c-1200-73f4bd007.png width=1200 height=770></picture></div></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Building an IKEA Firefly Light with ATtiny85</h1><span class=post-meta>Posted on May 8, 2017</span></div></div></div></div></div></header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Did you ever wanted your room decoration to be a smoothly fading light strip in a jar? Inspired by the Pimoroni firefly light I built my own variation with an ATtiny and two AA batteries instead of using a Raspberry Pi Zero and a huge battery pack.</p><p>There are three LED strings that fade in a sine pattern. Two of them fade anti parallel at one of 16 adjustable speeds. The third fades differently at a second configurable sine. This is how the final result looks like!</p><style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class=embed-container><iframe title="YouTube video player" width=640 height=390 src=//www.youtube.com/embed/UASnjQXvQ1c frameborder=0 allowfullscreen></iframe></div><p>After some planning I ended up buying three <a href=http://www.ikea.com/de/de/catalog/products/60277514/ target=_blank>SÄRDAL lights</a> and one <a href=http://www.ikea.com/de/de/catalog/products/10239888/ target=_blank>ENSIDIG jar</a> at IKEA for about €15.</p><p>Then after unboxing the lights, I completely disassembled them and desoldered the cables in order to attach them to the ATtiny later on. Some measuring showed that the inbuilt circuit boosts or drops down the voltage to about 2.6 V if load is applied. If the output doesn’t draw enough current the voltage jumps up like crazy. That is why I decided to power at least two strips anti parallel to manage a continuous minimum draw of one strip in sum. This means the two strips share the duty cycle of the PWM output. If one strip is of, the other one is on. I just added a third strip to give the whole thing a more beautiful attitude. This one runs on the second PWM channel output.</p><p>All three LED strips are power directly from the controller because each of them draws about 30 mA at around 2.6 V which is in the specs of the ATtiny.</p><p>In order to make some settings I added a jumper and a push button. The push button toggles through PWM 16 different prescalers to adjust the sine frequency whereas the jumper is used to decide which PWM channel should be adjusted.</p><p>Everything you need in addition to the IKEA stuff is</p><ul><li>1x Atmel ATtiny85</li><li>2x 100nF</li><li>1x quite big elko around 330µF to smooth the voltage</li><li>1x Push button</li><li>some double sided tape to attach the circuit to the battery housing</li></ul><h1 id=hardware>Hardware</h1><p>The images below show the schematics, pin mappings and the final circuit.</p><picture><source srcset="/assets/images/e32b059857dff549550e1b54af11b7b7d40ae34b-1000-db0e6c13d.webp 1000w, /assets/images/e32b059857dff549550e1b54af11b7b7d40ae34b-1600-db0e6c13d.webp 1600w" type=image/webp><source srcset="/assets/images/e32b059857dff549550e1b54af11b7b7d40ae34b-1000-db0e6c13d.png 1000w, /assets/images/e32b059857dff549550e1b54af11b7b7d40ae34b-1600-db0e6c13d.png 1600w" type=image/png><img class="img-responsive img-rounded picture-bot" src=/assets/images/e32b059857dff549550e1b54af11b7b7d40ae34b-1600-db0e6c13d.png width=1600 height=910></picture><picture><source srcset="/assets/images/cfd59410d40e5582a9800db67c8b7d795caa56cf-1000-ed45172c7.webp 1000w, /assets/images/cfd59410d40e5582a9800db67c8b7d795caa56cf-2000-ed45172c7.webp 2000w" type=image/webp><source srcset="/assets/images/cfd59410d40e5582a9800db67c8b7d795caa56cf-1000-ed45172c7.jpg 1000w, /assets/images/cfd59410d40e5582a9800db67c8b7d795caa56cf-2000-ed45172c7.jpg 2000w" type=image/jpeg><img class="img-responsive img-rounded picture-bot" src=/assets/images/cfd59410d40e5582a9800db67c8b7d795caa56cf-2000-ed45172c7.jpg width=2000 height=1283></picture><picture><source srcset="/assets/images/4e8e6eb050a494a0d67e73ce2700592bed4c9b93-1000-5acc2d9db.webp 1000w, /assets/images/4e8e6eb050a494a0d67e73ce2700592bed4c9b93-2000-5acc2d9db.webp 2000w" type=image/webp><source srcset="/assets/images/4e8e6eb050a494a0d67e73ce2700592bed4c9b93-1000-5acc2d9db.jpg 1000w, /assets/images/4e8e6eb050a494a0d67e73ce2700592bed4c9b93-2000-5acc2d9db.jpg 2000w" type=image/jpeg><img class="img-responsive img-rounded picture-bot" src=/assets/images/4e8e6eb050a494a0d67e73ce2700592bed4c9b93-2000-5acc2d9db.jpg width=2000 height=1283></picture><h1 id=software>Software</h1><figure class=highlight><pre><code class=language-javascript data-lang=javascript><table class=rouge-table><tbody><tr>
<td class="gutter gl"><pre class=lineno>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
</pre></td>
<td class=code><pre><span class=cm>/*
 * FireflyLight.c
 *
 * Created: 08.03.2017 12:18:04
 * Author : Dennis
 */</span>

<span class=err>#</span><span class=nx>include</span> <span class=o>&lt;</span><span class=nx>avr</span><span class=o>/</span><span class=nx>io</span><span class=p>.</span><span class=nx>h</span><span class=o>&gt;</span>
<span class=err>#</span><span class=nx>include</span> <span class=o>&lt;</span><span class=nx>avr</span><span class=o>/</span><span class=nx>interrupt</span><span class=p>.</span><span class=nx>h</span><span class=o>&gt;</span>
<span class=err>#</span><span class=nx>include</span> <span class=o>&lt;</span><span class=nx>avr</span><span class=o>/</span><span class=nx>pgmspace</span><span class=p>.</span><span class=nx>h</span><span class=o>&gt;</span>
<span class=err>#</span><span class=nx>include</span> <span class=o>&lt;</span><span class=nx>avr</span><span class=o>/</span><span class=nx>eeprom</span><span class=p>.</span><span class=nx>h</span><span class=o>&gt;</span>

<span class=err>#</span><span class=nx>define</span> <span class=nx>PRESCALER_MAX</span> <span class=mi>32</span>

<span class=nx>typedef</span> <span class=nx>struct</span>  
<span class=p>{</span>
  <span class=nx>volatile</span> <span class=nx>uint16_t</span> <span class=nx>position</span><span class=p>;</span>
  <span class=nx>volatile</span> <span class=nx>uint8_t</span> <span class=nx>prescaler</span><span class=p>;</span>
  <span class=nx>volatile</span> <span class=nx>uint8_t</span> <span class=nx>count</span><span class=p>;</span>
  <span class=nx>volatile</span> <span class=nx>uint8_t</span> <span class=nx>doSave</span><span class=p>;</span>
<span class=p>}</span> <span class=nx>sine_t</span><span class=p>;</span>

<span class=nx>volatile</span> <span class=nx>sine_t</span> <span class=nx>sineA</span><span class=p>;</span>
<span class=nx>volatile</span> <span class=nx>sine_t</span> <span class=nx>sineB</span><span class=p>;</span>

<span class=cm>/* on the fly calc:
//#define PI 3.14159265f
//value = (sinf(((float)count)*PI/180.f)+1.)*254./2.;  //254 to limit pwm at top
//OCR0A = (uint8_t)lrint(value);

jsfiddle:
var count = 0;
var a=[];
for (var i=0; i&lt;360; i++) {
  var value = (Math.sin(count*3.14159265/180)+1)*254/2;
  console.log(count, value.toFixed(0));
  a.push(parseInt(value.toFixed(0), 10));
  count = (count+1)%360;
}

var pad = function(number) {
  if (number &lt; 10) {
    return "  " + number;
  }
  if (number &lt; 100) {
    return " " + number;
  }
  return number;
}

var res = "";
for (var i=0; i&lt;360; i++) {
  res += pad(a[i]) + ", ";
  if (i != 0 &amp;&amp; (i+1) % 20 == 0) {
    res += "\n";
  }
}
console.log(res);
*/</span>

<span class=kd>const</span> <span class=nx>uint8_t</span> <span class=nx>sine</span><span class=p>[</span><span class=mi>360</span><span class=p>]</span> <span class=nx>PROGMEM</span> <span class=o>=</span> <span class=p>{</span>
  <span class=mi>127</span><span class=p>,</span> <span class=mi>129</span><span class=p>,</span> <span class=mi>131</span><span class=p>,</span> <span class=mi>134</span><span class=p>,</span> <span class=mi>136</span><span class=p>,</span> <span class=mi>138</span><span class=p>,</span> <span class=mi>140</span><span class=p>,</span> <span class=mi>142</span><span class=p>,</span> <span class=mi>145</span><span class=p>,</span> <span class=mi>147</span><span class=p>,</span> <span class=mi>149</span><span class=p>,</span> <span class=mi>151</span><span class=p>,</span> <span class=mi>153</span><span class=p>,</span> <span class=mi>156</span><span class=p>,</span> <span class=mi>158</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>162</span><span class=p>,</span> <span class=mi>164</span><span class=p>,</span> <span class=mi>166</span><span class=p>,</span> <span class=mi>168</span><span class=p>,</span>
  <span class=mi>170</span><span class=p>,</span> <span class=mi>173</span><span class=p>,</span> <span class=mi>175</span><span class=p>,</span> <span class=mi>177</span><span class=p>,</span> <span class=mi>179</span><span class=p>,</span> <span class=mi>181</span><span class=p>,</span> <span class=mi>183</span><span class=p>,</span> <span class=mi>185</span><span class=p>,</span> <span class=mi>187</span><span class=p>,</span> <span class=mi>189</span><span class=p>,</span> <span class=mi>190</span><span class=p>,</span> <span class=mi>192</span><span class=p>,</span> <span class=mi>194</span><span class=p>,</span> <span class=mi>196</span><span class=p>,</span> <span class=mi>198</span><span class=p>,</span> <span class=mi>200</span><span class=p>,</span> <span class=mi>202</span><span class=p>,</span> <span class=mi>203</span><span class=p>,</span> <span class=mi>205</span><span class=p>,</span> <span class=mi>207</span><span class=p>,</span>
  <span class=mi>209</span><span class=p>,</span> <span class=mi>210</span><span class=p>,</span> <span class=mi>212</span><span class=p>,</span> <span class=mi>214</span><span class=p>,</span> <span class=mi>215</span><span class=p>,</span> <span class=mi>217</span><span class=p>,</span> <span class=mi>218</span><span class=p>,</span> <span class=mi>220</span><span class=p>,</span> <span class=mi>221</span><span class=p>,</span> <span class=mi>223</span><span class=p>,</span> <span class=mi>224</span><span class=p>,</span> <span class=mi>226</span><span class=p>,</span> <span class=mi>227</span><span class=p>,</span> <span class=mi>228</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>231</span><span class=p>,</span> <span class=mi>232</span><span class=p>,</span> <span class=mi>234</span><span class=p>,</span> <span class=mi>235</span><span class=p>,</span> <span class=mi>236</span><span class=p>,</span>
  <span class=mi>237</span><span class=p>,</span> <span class=mi>238</span><span class=p>,</span> <span class=mi>239</span><span class=p>,</span> <span class=mi>240</span><span class=p>,</span> <span class=mi>241</span><span class=p>,</span> <span class=mi>242</span><span class=p>,</span> <span class=mi>243</span><span class=p>,</span> <span class=mi>244</span><span class=p>,</span> <span class=mi>245</span><span class=p>,</span> <span class=mi>246</span><span class=p>,</span> <span class=mi>246</span><span class=p>,</span> <span class=mi>247</span><span class=p>,</span> <span class=mi>248</span><span class=p>,</span> <span class=mi>248</span><span class=p>,</span> <span class=mi>249</span><span class=p>,</span> <span class=mi>250</span><span class=p>,</span> <span class=mi>250</span><span class=p>,</span> <span class=mi>251</span><span class=p>,</span> <span class=mi>251</span><span class=p>,</span> <span class=mi>252</span><span class=p>,</span>
  <span class=mi>252</span><span class=p>,</span> <span class=mi>252</span><span class=p>,</span> <span class=mi>253</span><span class=p>,</span> <span class=mi>253</span><span class=p>,</span> <span class=mi>253</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>254</span><span class=p>,</span> <span class=mi>253</span><span class=p>,</span> <span class=mi>253</span><span class=p>,</span> <span class=mi>253</span><span class=p>,</span> <span class=mi>252</span><span class=p>,</span>
  <span class=mi>252</span><span class=p>,</span> <span class=mi>252</span><span class=p>,</span> <span class=mi>251</span><span class=p>,</span> <span class=mi>251</span><span class=p>,</span> <span class=mi>250</span><span class=p>,</span> <span class=mi>250</span><span class=p>,</span> <span class=mi>249</span><span class=p>,</span> <span class=mi>248</span><span class=p>,</span> <span class=mi>248</span><span class=p>,</span> <span class=mi>247</span><span class=p>,</span> <span class=mi>246</span><span class=p>,</span> <span class=mi>246</span><span class=p>,</span> <span class=mi>245</span><span class=p>,</span> <span class=mi>244</span><span class=p>,</span> <span class=mi>243</span><span class=p>,</span> <span class=mi>242</span><span class=p>,</span> <span class=mi>241</span><span class=p>,</span> <span class=mi>240</span><span class=p>,</span> <span class=mi>239</span><span class=p>,</span> <span class=mi>238</span><span class=p>,</span>
  <span class=mi>237</span><span class=p>,</span> <span class=mi>236</span><span class=p>,</span> <span class=mi>235</span><span class=p>,</span> <span class=mi>234</span><span class=p>,</span> <span class=mi>232</span><span class=p>,</span> <span class=mi>231</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>228</span><span class=p>,</span> <span class=mi>227</span><span class=p>,</span> <span class=mi>226</span><span class=p>,</span> <span class=mi>224</span><span class=p>,</span> <span class=mi>223</span><span class=p>,</span> <span class=mi>221</span><span class=p>,</span> <span class=mi>220</span><span class=p>,</span> <span class=mi>218</span><span class=p>,</span> <span class=mi>217</span><span class=p>,</span> <span class=mi>215</span><span class=p>,</span> <span class=mi>214</span><span class=p>,</span> <span class=mi>212</span><span class=p>,</span> <span class=mi>210</span><span class=p>,</span>
  <span class=mi>209</span><span class=p>,</span> <span class=mi>207</span><span class=p>,</span> <span class=mi>205</span><span class=p>,</span> <span class=mi>203</span><span class=p>,</span> <span class=mi>202</span><span class=p>,</span> <span class=mi>200</span><span class=p>,</span> <span class=mi>198</span><span class=p>,</span> <span class=mi>196</span><span class=p>,</span> <span class=mi>194</span><span class=p>,</span> <span class=mi>192</span><span class=p>,</span> <span class=mi>191</span><span class=p>,</span> <span class=mi>189</span><span class=p>,</span> <span class=mi>187</span><span class=p>,</span> <span class=mi>185</span><span class=p>,</span> <span class=mi>183</span><span class=p>,</span> <span class=mi>181</span><span class=p>,</span> <span class=mi>179</span><span class=p>,</span> <span class=mi>177</span><span class=p>,</span> <span class=mi>175</span><span class=p>,</span> <span class=mi>173</span><span class=p>,</span>
  <span class=mi>170</span><span class=p>,</span> <span class=mi>168</span><span class=p>,</span> <span class=mi>166</span><span class=p>,</span> <span class=mi>164</span><span class=p>,</span> <span class=mi>162</span><span class=p>,</span> <span class=mi>160</span><span class=p>,</span> <span class=mi>158</span><span class=p>,</span> <span class=mi>156</span><span class=p>,</span> <span class=mi>153</span><span class=p>,</span> <span class=mi>151</span><span class=p>,</span> <span class=mi>149</span><span class=p>,</span> <span class=mi>147</span><span class=p>,</span> <span class=mi>145</span><span class=p>,</span> <span class=mi>142</span><span class=p>,</span> <span class=mi>140</span><span class=p>,</span> <span class=mi>138</span><span class=p>,</span> <span class=mi>136</span><span class=p>,</span> <span class=mi>134</span><span class=p>,</span> <span class=mi>131</span><span class=p>,</span> <span class=mi>129</span><span class=p>,</span>
  <span class=mi>127</span><span class=p>,</span> <span class=mi>125</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=mi>120</span><span class=p>,</span> <span class=mi>118</span><span class=p>,</span> <span class=mi>116</span><span class=p>,</span> <span class=mi>114</span><span class=p>,</span> <span class=mi>112</span><span class=p>,</span> <span class=mi>109</span><span class=p>,</span> <span class=mi>107</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>103</span><span class=p>,</span> <span class=mi>101</span><span class=p>,</span>  <span class=mi>98</span><span class=p>,</span>  <span class=mi>96</span><span class=p>,</span>  <span class=mi>94</span><span class=p>,</span>  <span class=mi>92</span><span class=p>,</span>  <span class=mi>90</span><span class=p>,</span>  <span class=mi>88</span><span class=p>,</span>  <span class=mi>86</span><span class=p>,</span>
   <span class=mi>84</span><span class=p>,</span>  <span class=mi>81</span><span class=p>,</span>  <span class=mi>79</span><span class=p>,</span>  <span class=mi>77</span><span class=p>,</span>  <span class=mi>75</span><span class=p>,</span>  <span class=mi>73</span><span class=p>,</span>  <span class=mi>71</span><span class=p>,</span>  <span class=mi>69</span><span class=p>,</span>  <span class=mi>67</span><span class=p>,</span>  <span class=mi>65</span><span class=p>,</span>  <span class=mi>64</span><span class=p>,</span>  <span class=mi>62</span><span class=p>,</span>  <span class=mi>60</span><span class=p>,</span>  <span class=mi>58</span><span class=p>,</span>  <span class=mi>56</span><span class=p>,</span>  <span class=mi>54</span><span class=p>,</span>  <span class=mi>52</span><span class=p>,</span>  <span class=mi>51</span><span class=p>,</span>  <span class=mi>49</span><span class=p>,</span>  <span class=mi>47</span><span class=p>,</span>
   <span class=mi>45</span><span class=p>,</span>  <span class=mi>44</span><span class=p>,</span>  <span class=mi>42</span><span class=p>,</span>  <span class=mi>40</span><span class=p>,</span>  <span class=mi>39</span><span class=p>,</span>  <span class=mi>37</span><span class=p>,</span>  <span class=mi>36</span><span class=p>,</span>  <span class=mi>34</span><span class=p>,</span>  <span class=mi>33</span><span class=p>,</span>  <span class=mi>31</span><span class=p>,</span>  <span class=mi>30</span><span class=p>,</span>  <span class=mi>28</span><span class=p>,</span>  <span class=mi>27</span><span class=p>,</span>  <span class=mi>26</span><span class=p>,</span>  <span class=mi>24</span><span class=p>,</span>  <span class=mi>23</span><span class=p>,</span>  <span class=mi>22</span><span class=p>,</span>  <span class=mi>20</span><span class=p>,</span>  <span class=mi>19</span><span class=p>,</span>  <span class=mi>18</span><span class=p>,</span>
   <span class=mi>17</span><span class=p>,</span>  <span class=mi>16</span><span class=p>,</span>  <span class=mi>15</span><span class=p>,</span>  <span class=mi>14</span><span class=p>,</span>  <span class=mi>13</span><span class=p>,</span>  <span class=mi>12</span><span class=p>,</span>  <span class=mi>11</span><span class=p>,</span>  <span class=mi>10</span><span class=p>,</span>   <span class=mi>9</span><span class=p>,</span>   <span class=mi>8</span><span class=p>,</span>   <span class=mi>8</span><span class=p>,</span>   <span class=mi>7</span><span class=p>,</span>   <span class=mi>6</span><span class=p>,</span>   <span class=mi>6</span><span class=p>,</span>   <span class=mi>5</span><span class=p>,</span>   <span class=mi>4</span><span class=p>,</span>   <span class=mi>4</span><span class=p>,</span>   <span class=mi>3</span><span class=p>,</span>   <span class=mi>3</span><span class=p>,</span>   <span class=mi>2</span><span class=p>,</span>
    <span class=mi>2</span><span class=p>,</span>   <span class=mi>2</span><span class=p>,</span>   <span class=mi>1</span><span class=p>,</span>   <span class=mi>1</span><span class=p>,</span>   <span class=mi>1</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>0</span><span class=p>,</span>   <span class=mi>1</span><span class=p>,</span>   <span class=mi>1</span><span class=p>,</span>   <span class=mi>1</span><span class=p>,</span>   <span class=mi>2</span><span class=p>,</span>
    <span class=mi>2</span><span class=p>,</span>   <span class=mi>2</span><span class=p>,</span>   <span class=mi>3</span><span class=p>,</span>   <span class=mi>3</span><span class=p>,</span>   <span class=mi>4</span><span class=p>,</span>   <span class=mi>4</span><span class=p>,</span>   <span class=mi>5</span><span class=p>,</span>   <span class=mi>6</span><span class=p>,</span>   <span class=mi>6</span><span class=p>,</span>   <span class=mi>7</span><span class=p>,</span>   <span class=mi>8</span><span class=p>,</span>   <span class=mi>8</span><span class=p>,</span>   <span class=mi>9</span><span class=p>,</span>  <span class=mi>10</span><span class=p>,</span>  <span class=mi>11</span><span class=p>,</span>  <span class=mi>12</span><span class=p>,</span>  <span class=mi>13</span><span class=p>,</span>  <span class=mi>14</span><span class=p>,</span>  <span class=mi>15</span><span class=p>,</span>  <span class=mi>16</span><span class=p>,</span>
   <span class=mi>17</span><span class=p>,</span>  <span class=mi>18</span><span class=p>,</span>  <span class=mi>19</span><span class=p>,</span>  <span class=mi>20</span><span class=p>,</span>  <span class=mi>22</span><span class=p>,</span>  <span class=mi>23</span><span class=p>,</span>  <span class=mi>24</span><span class=p>,</span>  <span class=mi>26</span><span class=p>,</span>  <span class=mi>27</span><span class=p>,</span>  <span class=mi>28</span><span class=p>,</span>  <span class=mi>30</span><span class=p>,</span>  <span class=mi>31</span><span class=p>,</span>  <span class=mi>33</span><span class=p>,</span>  <span class=mi>34</span><span class=p>,</span>  <span class=mi>36</span><span class=p>,</span>  <span class=mi>37</span><span class=p>,</span>  <span class=mi>39</span><span class=p>,</span>  <span class=mi>40</span><span class=p>,</span>  <span class=mi>42</span><span class=p>,</span>  <span class=mi>44</span><span class=p>,</span>
   <span class=mi>45</span><span class=p>,</span>  <span class=mi>47</span><span class=p>,</span>  <span class=mi>49</span><span class=p>,</span>  <span class=mi>51</span><span class=p>,</span>  <span class=mi>52</span><span class=p>,</span>  <span class=mi>54</span><span class=p>,</span>  <span class=mi>56</span><span class=p>,</span>  <span class=mi>58</span><span class=p>,</span>  <span class=mi>60</span><span class=p>,</span>  <span class=mi>62</span><span class=p>,</span>  <span class=mi>63</span><span class=p>,</span>  <span class=mi>65</span><span class=p>,</span>  <span class=mi>67</span><span class=p>,</span>  <span class=mi>69</span><span class=p>,</span>  <span class=mi>71</span><span class=p>,</span>  <span class=mi>73</span><span class=p>,</span>  <span class=mi>75</span><span class=p>,</span>  <span class=mi>77</span><span class=p>,</span>  <span class=mi>79</span><span class=p>,</span>  <span class=mi>81</span><span class=p>,</span>
   <span class=mi>84</span><span class=p>,</span>  <span class=mi>86</span><span class=p>,</span>  <span class=mi>88</span><span class=p>,</span>  <span class=mi>90</span><span class=p>,</span>  <span class=mi>92</span><span class=p>,</span>  <span class=mi>94</span><span class=p>,</span>  <span class=mi>96</span><span class=p>,</span>  <span class=mi>98</span><span class=p>,</span> <span class=mi>101</span><span class=p>,</span> <span class=mi>103</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>107</span><span class=p>,</span> <span class=mi>109</span><span class=p>,</span> <span class=mi>112</span><span class=p>,</span> <span class=mi>114</span><span class=p>,</span> <span class=mi>116</span><span class=p>,</span> <span class=mi>118</span><span class=p>,</span> <span class=mi>120</span><span class=p>,</span> <span class=mi>123</span><span class=p>,</span> <span class=mi>125</span>
<span class=p>};</span>

<span class=nx>ISR</span><span class=p>(</span><span class=nx>TIMER1_COMPA_vect</span><span class=p>)</span>
<span class=p>{</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>sineA</span><span class=p>.</span><span class=nx>count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
  <span class=p>{</span>
    <span class=nx>OCR0A</span> <span class=o>=</span> <span class=nx>pgm_read_byte</span><span class=p>(</span><span class=o>&amp;</span><span class=p>(</span><span class=nx>sine</span><span class=p>[</span><span class=nx>sineA</span><span class=p>.</span><span class=nx>position</span><span class=p>]));</span>
    <span class=nx>OCR0B</span> <span class=o>=</span> <span class=nx>OCR0A</span><span class=p>;</span>
    <span class=nx>sineA</span><span class=p>.</span><span class=nx>position</span> <span class=o>=</span> <span class=p>(</span><span class=nx>sineA</span><span class=p>.</span><span class=nx>position</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=mi>360</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=k>if</span> <span class=p>(</span><span class=nx>sineB</span><span class=p>.</span><span class=nx>count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
  <span class=p>{</span>
    <span class=nx>OCR1B</span> <span class=o>=</span> <span class=nx>pgm_read_byte</span><span class=p>(</span><span class=o>&amp;</span><span class=p>(</span><span class=nx>sine</span><span class=p>[</span><span class=nx>sineB</span><span class=p>.</span><span class=nx>position</span><span class=p>]));</span>
    <span class=nx>sineB</span><span class=p>.</span><span class=nx>position</span> <span class=o>=</span> <span class=p>(</span><span class=nx>sineB</span><span class=p>.</span><span class=nx>position</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=mi>360</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=nx>sineA</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=p>(</span><span class=nx>sineA</span><span class=p>.</span><span class=nx>count</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=nx>sineA</span><span class=p>.</span><span class=nx>prescaler</span><span class=p>;</span>
  <span class=nx>sineB</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=p>(</span><span class=nx>sineB</span><span class=p>.</span><span class=nx>count</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=nx>sineB</span><span class=p>.</span><span class=nx>prescaler</span><span class=p>;</span>
<span class=p>}</span>

<span class=nx>ISR</span><span class=p>(</span><span class=nx>INT0_vect</span><span class=p>)</span>
<span class=p>{</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>PINB</span> <span class=o>&amp;</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PB3</span><span class=p>))</span>
  <span class=p>{</span>
    <span class=nx>sineA</span><span class=p>.</span><span class=nx>prescaler</span> <span class=o>=</span> <span class=p>(</span><span class=nx>sineA</span><span class=p>.</span><span class=nx>prescaler</span><span class=o>+</span><span class=mi>2</span><span class=p>)</span> <span class=o>%</span> <span class=nx>PRESCALER_MAX</span><span class=p>;</span>
    <span class=nx>sineA</span><span class=p>.</span><span class=nx>doSave</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
  <span class=p>}</span>
  <span class=k>else</span>
  <span class=p>{</span>
    <span class=nx>sineB</span><span class=p>.</span><span class=nx>prescaler</span> <span class=o>=</span> <span class=p>(</span><span class=nx>sineB</span><span class=p>.</span><span class=nx>prescaler</span><span class=o>+</span><span class=mi>2</span><span class=p>)</span> <span class=o>%</span> <span class=nx>PRESCALER_MAX</span><span class=p>;</span>
    <span class=nx>sineB</span><span class=p>.</span><span class=nx>doSave</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
  <span class=p>}</span>
<span class=p>}</span>

<span class=k>void</span> <span class=nx>sleep</span><span class=p>()</span>
<span class=p>{</span>
  <span class=nx>ADCSRA</span> <span class=o>&amp;=</span> <span class=o>~</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>ADEN</span><span class=p>);</span> <span class=c1>//disable adc</span>
  <span class=nx>ACSR</span> <span class=o>=</span> <span class=mh>0x80</span><span class=p>;</span> <span class=c1>// disable analouge comp</span>
  <span class=c1>//MCUCSR |= (1&lt;&lt;JTD); // disable jtag</span>

  <span class=c1>//MCUCR &amp;= ~0x3;</span>
  <span class=c1>//sei();</span>
  <span class=c1>//MCUCR |= (1&lt;&lt;SM1) | (1&lt;&lt;SM0); // Power down</span>
  <span class=nx>MCUCR</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>SE</span><span class=p>);</span> <span class=c1>// Sleep enable</span>
  <span class=nx>asm</span><span class=p>(</span><span class=dl>"</span><span class=s2>sleep</span><span class=dl>"</span><span class=p>);</span>
  <span class=nx>MCUCR</span> <span class=o>&amp;=</span> <span class=o>~</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>SE</span><span class=p>);</span> <span class=c1>// Sleep disable</span>
<span class=p>}</span>

<span class=nx>int</span> <span class=nx>main</span><span class=p>(</span><span class=k>void</span><span class=p>)</span>
<span class=p>{</span>
  <span class=nx>DDRB</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PB0</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PB1</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PB4</span><span class=p>);</span>
  <span class=nx>PORTB</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PB2</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PB3</span><span class=p>);</span> <span class=c1>//pullup int0, select jumper</span>
  <span class=nx>TCCR0A</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>COM0A1</span><span class=p>);</span>
  <span class=nx>TCCR0A</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>COM0B1</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>COM0B0</span><span class=p>);</span> <span class=c1>//inverted B</span>
  <span class=nx>TCCR0A</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>WGM01</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>WGM00</span><span class=p>);</span> <span class=c1>//fast PWM</span>
  <span class=nx>TCCR0B</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>CS00</span><span class=p>);</span> <span class=c1>//prescaler</span>
  <span class=nx>OCR0A</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
  <span class=nx>OCR0B</span> <span class=o>=</span> <span class=mh>0xFF</span><span class=p>;</span>

  <span class=nx>TCCR1</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>CS10</span><span class=p>);</span> <span class=c1>//prescaler</span>
  <span class=nx>OCR1A</span> <span class=o>=</span> <span class=mh>0xFF</span><span class=p>;</span>
  <span class=nx>TIMSK</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>OCIE1A</span><span class=p>);</span> <span class=c1>//int on compare match</span>

  <span class=nx>GTCCR</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PWM1B</span><span class=p>);</span> <span class=c1>//pwm output</span>
  <span class=nx>GTCCR</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>COM1B1</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>COM1B1</span><span class=p>);</span> <span class=c1>//output mode</span>
  <span class=nx>OCR1B</span> <span class=o>=</span> <span class=mi>128</span><span class=p>;</span>
  <span class=nx>OCR1C</span> <span class=o>=</span> <span class=mh>0xFF</span><span class=p>;</span>

  <span class=nx>MCUCR</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>ISC01</span><span class=p>);</span> <span class=c1>//falling edge</span>
  <span class=nx>GIMSK</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>INT0</span><span class=p>);</span>

  <span class=c1>//power reduction</span>
  <span class=nx>PRR</span> <span class=o>|=</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PRUSI</span><span class=p>)</span> <span class=o>|</span> <span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=nx>PRADC</span><span class=p>);</span>

  <span class=nx>sineA</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
  <span class=nx>sineA</span><span class=p>.</span><span class=nx>position</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
  <span class=nx>sineA</span><span class=p>.</span><span class=nx>doSave</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
  <span class=nx>sineB</span><span class=p>.</span><span class=nx>count</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
  <span class=nx>sineB</span><span class=p>.</span><span class=nx>position</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
  <span class=nx>sineB</span><span class=p>.</span><span class=nx>doSave</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>

  <span class=nx>sineA</span><span class=p>.</span><span class=nx>prescaler</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
  <span class=nx>sineB</span><span class=p>.</span><span class=nx>prescaler</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>

  <span class=nx>eeprom_busy_wait</span><span class=p>();</span>
  <span class=nx>uint8_t</span> <span class=nx>val</span> <span class=o>=</span> <span class=nx>eeprom_read_byte</span><span class=p>((</span><span class=nx>uint8_t</span><span class=o>*</span><span class=p>)</span><span class=mh>0x00</span><span class=p>);</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>val</span> <span class=o>&gt;=</span> <span class=mh>0x00</span> <span class=o>&amp;&amp;</span> <span class=nx>val</span> <span class=o>&lt;</span> <span class=mh>0xFF</span><span class=p>)</span>
  <span class=p>{</span>
    <span class=nx>sineA</span><span class=p>.</span><span class=nx>prescaler</span> <span class=o>=</span> <span class=nx>val</span><span class=p>;</span>
  <span class=p>}</span>
  <span class=nx>eeprom_busy_wait</span><span class=p>();</span>
  <span class=nx>val</span> <span class=o>=</span> <span class=nx>eeprom_read_byte</span><span class=p>((</span><span class=nx>uint8_t</span><span class=o>*</span><span class=p>)</span><span class=mh>0x01</span><span class=p>);</span>
  <span class=k>if</span> <span class=p>(</span><span class=nx>val</span> <span class=o>&gt;=</span> <span class=mh>0x00</span> <span class=o>&amp;&amp;</span> <span class=nx>val</span> <span class=o>&lt;</span> <span class=mh>0xFF</span><span class=p>)</span>
  <span class=p>{</span>
    <span class=nx>sineB</span><span class=p>.</span><span class=nx>prescaler</span> <span class=o>=</span> <span class=nx>val</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=nx>sei</span><span class=p>();</span>

  <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
  <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>sineA</span><span class=p>.</span><span class=nx>doSave</span><span class=p>)</span>
    <span class=p>{</span>
      <span class=nx>eeprom_busy_wait</span><span class=p>();</span>
      <span class=nx>eeprom_update_byte</span><span class=p>((</span><span class=nx>uint8_t</span><span class=o>*</span><span class=p>)</span><span class=mh>0x00</span><span class=p>,</span> <span class=nx>sineA</span><span class=p>.</span><span class=nx>prescaler</span><span class=p>);</span>
      <span class=nx>sineA</span><span class=p>.</span><span class=nx>doSave</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>if</span> <span class=p>(</span><span class=nx>sineB</span><span class=p>.</span><span class=nx>doSave</span><span class=p>)</span>
    <span class=p>{</span>
      <span class=nx>eeprom_busy_wait</span><span class=p>();</span>
      <span class=nx>eeprom_update_byte</span><span class=p>((</span><span class=nx>uint8_t</span><span class=o>*</span><span class=p>)</span><span class=mh>0x01</span><span class=p>,</span> <span class=nx>sineB</span><span class=p>.</span><span class=nx>prescaler</span><span class=p>);</span>
      <span class=nx>sineB</span><span class=p>.</span><span class=nx>doSave</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nx>sleep</span><span class=p>();</span>
  <span class=p>}</span>
<span class=p>}</span>
</pre></td>
</tr></tbody></table></code></pre></figure></article><div class=blog-tags>Tags: <a href=/tags#Hardware>Hardware</a> <a href=/tags#C/C++>C/C++</a> <a href=/tags#Microcontroller>Microcontroller</a></div><ul class="pager blog-pager"><li class=previous><a href=/2017/05/smtp-mailing-mailgun-postfix/ data-toggle=tooltip data-placement=top title="SMTP Mailing with Mailgun and Postfix">&larr; Previous Post</a></li><li class=next><a href=/2018/02/eufy-lumi-smooth-fader/ data-toggle=tooltip data-placement=top title="eufy Lumi Stick-On: Fading Night Light">Next Post &rarr;</a></li></ul><div class=disqus-comments><div class=comments><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname = 'dev-shyd';
        var disqus_identifier = '3826 http://dev.shyd.de/?p=3826';
        var disqus_title = 'Building an IKEA Firefly Light with ATtiny85';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=/feed.xml title=RSS target=_blank><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span><span class=sr-only>RSS</span></a></li><li><a href=/contact title="Email me"><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-envelope fa-stack-1x fa-inverse"></i> </span><span class=sr-only>Email me</span></a></li><li><a href=https://github.com/shyd title=GitHub target=_blank><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span><span class=sr-only>GitHub</span></a></li><li><a href=https://hub.docker.com/u/shyd title=Docker target=_blank><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-docker fa-stack-1x fa-inverse"></i> </span><span class=sr-only>Docker</span></a></li><li><a href=https://www.instagram.com/d_nn__ title=Instagram target=_blank><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-instagram fa-stack-1x fa-inverse"></i> </span><span class=sr-only>Instagram</span></a></li></ul><p class="copyright text-muted">&copy; Dennis Schütt &nbsp;&bull;&nbsp; 2020 &nbsp;&bull;&nbsp; made with ❤️ by <a href=https://schuett.io>schuett.io</a></p><p class="theme-by text-muted">Theme by <a href=http://deanattali.com/beautiful-jekyll/ >beautiful-jekyll</a></p></div></div></div></footer><script src=/assets/javascript/index-c3e323855a.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-18006649-7','auto');ga('set','anonymizeIp',true);ga('send','pageview');</script></body></html>