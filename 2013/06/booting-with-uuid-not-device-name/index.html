<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Jekyll v4.1.1"><meta property=og:title content="Dockstar/Golfex: booting with LABEL or UUID instead of device name"><meta name=author content="Dennis Schütt"><meta property=og:locale content=en_US><meta name=description content="Did you want to reboot your Dockstar or Golfex with multiple drives attached? Well, that’s not the problem if uboot lists the devices in the correct order. But what if your Golfex has SATA drives attached and you want to boot from an usb-drive?"><meta property=og:description content="Did you want to reboot your Dockstar or Golfex with multiple drives attached? Well, that’s not the problem if uboot lists the devices in the correct order. But what if your Golfex has SATA drives attached and you want to boot from an usb-drive?"><link rel=canonical href=https://schuett.io/2013/06/booting-with-uuid-not-device-name/ ><meta property=og:url content=https://schuett.io/2013/06/booting-with-uuid-not-device-name/ ><meta property=og:site_name content=schuett.io><meta property=og:image content=https://schuett.io/f1d3f2586770c5e9c9a4acdc5d50579a8968857a.png><meta property=og:type content=article><meta property=article:published_time content=2013-06-07T17:42:29+02:00><meta name=twitter:card content=summary_large_image><meta property=twitter:image content=https://schuett.io/f1d3f2586770c5e9c9a4acdc5d50579a8968857a.png><meta property=twitter:title content="Dockstar/Golfex: booting with LABEL or UUID instead of device name"><script type=application/ld+json>{"datePublished":"2013-06-07T17:42:29+02:00","image":"https://schuett.io/f1d3f2586770c5e9c9a4acdc5d50579a8968857a.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://schuett.io/2013/06/booting-with-uuid-not-device-name/"},"url":"https://schuett.io/2013/06/booting-with-uuid-not-device-name/","author":{"@type":"Person","name":"Dennis Schütt"},"description":"Did you want to reboot your Dockstar or Golfex with multiple drives attached? Well, that’s not the problem if uboot lists the devices in the correct order. But what if your Golfex has SATA drives attached and you want to boot from an usb-drive?","headline":"Dockstar/Golfex: booting with LABEL or UUID instead of device name","dateModified":"2013-06-07T17:42:29+02:00","@type":"BlogPosting","@context":"https://schema.org"}</script><title>Dockstar/Golfex: booting with LABEL or UUID instead of device name &middot; schuett.io</title><meta name=author content="Dennis Schütt"><link rel=alternate type=application/rss+xml title="schuett.io &middot; another tech blog.
" href=/feed.xml><link rel=stylesheet href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=/assets/stylesheets/styles-9045b1fd1b.min.css><link rel="shortcut icon" type=image/x-icon href=/assets/images/favicon.ico><link rel=icon type=image/x-icon href=/assets/images/favicon.ico><link rel=icon type=image/gif href=/assets/images/favicon.gif><link rel=icon type=image/png href=/assets/images/favicon.png><link rel=apple-touch-icon href=/assets/images/apple-touch-icon.png><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-57x57.png sizes=57x57><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-60x60.png sizes=60x60><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-72x72.png sizes=72x72><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-76x76.png sizes=76x76><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-114x114.png sizes=114x114><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-120x120.png sizes=120x120><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-128x128.png sizes=128x128><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-144x144.png sizes=144x144><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-152x152.png sizes=152x152><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-180x180.png sizes=180x180><link rel=apple-touch-icon href=/assets/images/apple-touch-icon-precomposed.png><link rel=icon type=image/png href=/assets/images/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/assets/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/images/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/assets/images/favicon-160x160.png sizes=160x160><link rel=icon type=image/png href=/assets/images/favicon-192x192.png sizes=192x192><link rel=icon type=image/png href=/assets/images/favicon-196x196.png sizes=196x196><meta name=msapplication-TileColor content=#ffffff><meta name=msapplication-navbutton-color content=#ffffff><meta name=application-name content=schuett.io><meta name=msapplication-tooltip content=schuett.io><meta name=apple-mobile-web-app-title content=schuett.io></head><body><!--[if lt IE 10]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]--><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href=https://schuett.io><span class="fa-layers fa-fw"><i class="far fa-window-maximize" style="" data-fa-transform=""></i> <i class="fas fa-chevron-left" data-fa-transform="shrink-13 down-2 left-4.7"></i> <i class="fas fa-chevron-right" data-fa-transform="shrink-13 down-2 right-4.7"></i> <i class="fas fa-cogs" data-fa-transform="shrink-11 down-2"></i> </span><span>schuett.io</span></a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a href=/ >Blog</a></li><li><a href=/tags>Tags</a></li><li><a href=/wtf>About</a></li><li><a href=/contact>Contact</a></li><li><a href=/imprint>Imprint</a></li></ul></div></div></nav><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="page-image large"><picture><source srcset="/assets/images/f1d3f2586770c5e9c9a4acdc5d50579a8968857a-220-3eef370d9.webp 220w" type=image/webp><source srcset="/assets/images/f1d3f2586770c5e9c9a4acdc5d50579a8968857a-220-3eef370d9.png 220w" type=image/png><img src=/assets/images/f1d3f2586770c5e9c9a4acdc5d50579a8968857a-220-3eef370d9.png width=220 height=259></picture></div></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Dockstar/Golfex: booting with LABEL or UUID instead of device name</h1><span class=post-meta>Posted on June 7, 2013</span></div></div></div></div></div></header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Did you want to reboot your Dockstar or Golfex with multiple drives attached? Well, that’s not the problem if uboot lists the devices in the correct order. But what if your Golfex has SATA drives attached and you want to boot from an usb-drive?</p><p>The answer my Goflex gives me all the time: Loading kernel from usb works. Starting the kernel also works. But mounting the filesystem fails, because the device names are remapped when the SATA drives are initialized. The usb-drive ain’t <code class="language-plaintext highlighter-rouge">/dev/sda</code> anymore…</p><p>I (have) had one rule since I had to drive more than 100 kilometers to fix that: never reboot remotely with SATA attached. 😠</p><p>The solution is quite simple: We have to tell the kernel properly where to get the rootfs from to mount it. To be versatile, uboot is configured to boot the kernel with device names as parameter, such as <code class="language-plaintext highlighter-rouge">/dev/sda1</code>. But I know what I am doing and want to boot from one single device, no matter if other drives are attached or not, which could mess the device names. So the disk LABEL or the Universally Unique Identifier (UUID) is what we need. You might say: Ha! I adapt <code class="language-plaintext highlighter-rouge">fstab</code>. But this doesn’t do the trick.</p><p>We need to alter the uboot bootargs. You have to decide which method is more suitable for your environment.</p><p>First of all backup the current argument:</p><div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>fw_printenv usb_set_bootargs
usb_set_bootargs=setenv bootargs console=$console root=&amp;usb_root rootdelay=$usb_rootdelay rootfstype=$usb_rootfstype $mtdparts $usb_custom_params
</code></pre></div></div><h1 id=label-method>LABEL method</h1><p>The more flexible method is to use the disk LABEL. It allows you to easily change your boot device without modifying the uboot vars.</p><p>Determine the rootfs’ LABEL:</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>blkid
/dev/sdc1: <span class=nv>LABEL</span><span class=o>=</span><span class=s2>"my-rootfs"</span> <span class=nv>UUID</span><span class=o>=</span><span class=s2>"4812b490-4104-5b33-85ae-7aa4ba635173"</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>"ext2"</span> <span class=c># that's it</span>
/dev/sdc2: <span class=nv>UUID</span><span class=o>=</span><span class=s2>"d8ae81eb-28ff-a983-42a6-28d2b868759c"</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>"swap"</span>
</code></pre></div></div><p>Now alter <code class="language-plaintext highlighter-rouge">usb_set_bootargs</code> and <code class="language-plaintext highlighter-rouge">create usb_root_label</code>:</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>fw_setenv usb_set_bootargs setenv bootargs <span class=nv>console</span><span class=o>=</span><span class=se>\$</span>console <span class=nv>root</span><span class=o>=</span><span class=nv>LABEL</span><span class=o>=</span><span class=se>\$</span>usb_root_label <span class=nv>rootdelay</span><span class=o>=</span><span class=se>\$</span>usb_rootdelay <span class=nv>rootfstype</span><span class=o>=</span><span class=se>\$</span>usb_rootfstype <span class=se>\$</span>mtdparts <span class=se>\$</span>usb_custom_params
fw_setenv usb_root_label my-rootfs
</code></pre></div></div><h1 id=uuid-method>UUID method</h1><p><strong>Before you start:</strong> If you change your bootdevice or change it’s UUID, your device will most likely fail to boot! I have a fallback rescue system installed on nand, and a serial console to debug things. If you are not on the latest uboot or you didn’t use Jeff’s uboot script, your output may vary.</p><p>Determine the rootfs’ UUID:</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>blkid
/dev/sdc1: <span class=nv>LABEL</span><span class=o>=</span><span class=s2>"my-rootfs"</span> <span class=nv>UUID</span><span class=o>=</span><span class=s2>"4812b490-4104-5b33-85ae-7aa4ba635173"</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>"ext2"</span> <span class=c># that's it</span>
/dev/sdc2: <span class=nv>UUID</span><span class=o>=</span><span class=s2>"d8ae81eb-28ff-a983-42a6-28d2b868759c"</span> <span class=nv>TYPE</span><span class=o>=</span><span class=s2>"swap"</span>
</code></pre></div></div><p>Now alter <code class="language-plaintext highlighter-rouge">usb_set_bootargs</code> and <code class="language-plaintext highlighter-rouge">create usb_root_uuid</code>:</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>fw_setenv usb_set_bootargs setenv bootargs <span class=nv>console</span><span class=o>=</span><span class=se>\$</span>console <span class=nv>root</span><span class=o>=</span><span class=nv>UUID</span><span class=o>=</span><span class=se>\$</span>usb_root_uuid <span class=nv>rootdelay</span><span class=o>=</span><span class=se>\$</span>usb_rootdelay <span class=nv>rootfstype</span><span class=o>=</span><span class=se>\$</span>usb_rootfstype <span class=se>\$</span>mtdparts <span class=se>\$</span>usb_custom_params
fw_setenv usb_root_uuid 4812b490-4104-5b33-85ae-7aa4ba635173
</code></pre></div></div><p>If you do this directly in uboot use printenv, setenv and saveenv instead of <code class="language-plaintext highlighter-rouge">fw_printenv</code> and <code class="language-plaintext highlighter-rouge">fw_setenv</code>.</p><h1 id=reboot>Reboot</h1><p>Now give it a try and reboot your system.</p><p>To verify your work, check <code class="language-plaintext highlighter-rouge">mount</code>. It should look like this:</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>mount
/dev/disk/by-uuid/4812b490-4104-5b33-85ae-7aa4ba635173 on / <span class=nb>type </span>ext2 <span class=o>(</span>rw,noatime,errors<span class=o>=</span>remount-ro,user_xattr,acl<span class=o>)</span>
</code></pre></div></div><p><strong>NOT</strong> like this:</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>/dev/sda1 on / <span class=nb>type </span>ext2 <span class=o>(</span>rw,noatime,errors<span class=o>=</span>remount-ro<span class=o>)</span>
</code></pre></div></div><h1 id=update-09062013>Update 09.06.2013:</h1><p>Thanks to chessplayer pointing at the advantages/disadvantages on these methods! I’ve rewritten this article to have both methods together in one place.</p></article><div class=blog-tags>Tags: <a href=/tags#Hardware>Hardware</a> <a href=/tags#Dockstar>Dockstar</a> <a href=/tags#Linux>Linux</a> <a href=/tags#Goflex>Goflex</a></div><ul class="pager blog-pager"><li class=previous><a href=/2012/07/raspberry-pi-setup-debian-sandisk-extreme/ data-toggle=tooltip data-placement=top title="Raspberry Pi: Setup Debian with SanDisk Extreme">&larr; Previous Post</a></li><li class=next><a href=/2013/06/ftdi-interfacing-ft1248-ft220x-spi/ data-toggle=tooltip data-placement=top title="FTDI: interfacing FT1248/FT220x over SPI">Next Post &rarr;</a></li></ul><div class=disqus-comments><div class=comments><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname = 'dev-shyd';
        var disqus_identifier = '985 http://dev.shyd.de/?p=985';
        var disqus_title = 'Dockstar/Golfex: booting with LABEL or UUID instead of device name';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=/feed.xml title=RSS target=_blank><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i> </span><span class=sr-only>RSS</span></a></li><li><a href=/contact title="Email me"><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-envelope fa-stack-1x fa-inverse"></i> </span><span class=sr-only>Email me</span></a></li><li><a href=https://github.com/shyd title=GitHub target=_blank><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i> </span><span class=sr-only>GitHub</span></a></li><li><a href=https://hub.docker.com/u/shyd title=Docker target=_blank><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-docker fa-stack-1x fa-inverse"></i> </span><span class=sr-only>Docker</span></a></li><li><a href=https://www.instagram.com/d_nn__ title=Instagram target=_blank><span class="fa-stack fa-lg" aria-hidden=true><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-instagram fa-stack-1x fa-inverse"></i> </span><span class=sr-only>Instagram</span></a></li></ul><p class="copyright text-muted">&copy; Dennis Schütt &nbsp;&bull;&nbsp; 2021 &nbsp;&bull;&nbsp; made with ❤️ by <a href=https://schuett.io>schuett.io</a></p><p class="theme-by text-muted">Theme by <a href=http://deanattali.com/beautiful-jekyll/ >beautiful-jekyll</a></p></div></div></div></footer><script src=/assets/javascript/index-34a5463a7c.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-18006649-7','auto');ga('set','anonymizeIp',true);ga('send','pageview');</script></body></html>